<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<title>Inventaire Complet - Gestion Matériel</title>
        <meta name="csrf-token" content="{{ csrf_token() }}">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
		<script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
	</head>
	<body data-add-url="{{ url_for('inventaire.ajouter_objet') }}">
		{% include 'header.html' %}
		<div class="main-container">

			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					<div class="flash-messages">
					{% for category, message in messages %}
						<div class="flash {{ category }}">{{ message }}</div>
					{% endfor %}
					</div>
				{% endif %}
			{% endwith %}

			<div class="filtres-section">
				<div class="filter-group">
					<label for="search-input">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
						Rechercher :
					</label>
					<input type="search" id="search-input" name="q" placeholder="Nom de l'objet..." value="{{ request.args.get('q', '') }}">
				</div>
				
				<div class="filter-group">
					<label for="filtre-armoire">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M600-40q-33 0-56.5-23.5T520-120q0-23 11-41t29-29v-221q-18-11-29-28.5T520-480q0-33 23.5-56.5T600-560q33 0 56.5 23.5T680-480q0 23-11 40.5T640-411v115l160-53v-62q-18-11-29-28.5T760-480q0-33 23.5-56.5T840-560q33 0 56.5 23.5T920-480q0 23-11 40.5T880-411v119l-240 80v22q18 11 29 29t11 41q0 33-23.5 56.5T600-40ZM160-160v-560 560Zm0 0q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640H447l-80-80H160v480h280v80H160Z"/></svg>
						Armoire :
					</label>
					<select id="filtre-armoire" name="armoire">
						<option value="">Toutes</option>
						{% for a in armoires %}<option value="{{ a.id }}" {% if request.args.get('armoire') == a.id|string %}selected{% endif %}>{{ a.nom }}</option>{% endfor %}
					</select>
				</div>
				
				<div class="filter-group">
					<label for="filtre-categorie">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M160-480v240-480 240Zm400 360q17 0 28.5-11.5T600-160q0-17-11.5-28.5T560-200q-17 0-28.5 11.5T520-160q0 17 11.5 28.5T560-120Zm240-400q17 0 28.5-11.5T840-560q0-17-11.5-28.5T800-600q-17 0-28.5 11.5T760-560q0 17 11.5 28.5T800-520Zm-560 0h200v-80H240v80Zm0 160h200v-80H240v80Zm-80 200q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720H160v480h200v80H160ZM560-40q-50 0-85-35t-35-85q0-39 22.5-70t57.5-43v-127h240v-47q-35-12-57.5-43T680-560q0-50 35-85t85-35q50 0 85 35t35 85q0 39-22.5 70T840-447v127H600v47q35 12 57.5 43t22.5 70q0 50-35 85t-85 35Z"/></svg>
						Catégorie :
					</label>
					<select id="filtre-categorie" name="categorie">
						<option value="">Toutes</option>
						{% for c in categories %}<option value="{{ c.id }}" {% if request.args.get('categorie') == c.id|string %}selected{% endif %}>{{ c.nom }}</option>{% endfor %}
					</select>
				</div>

				<div class="filter-group">
					<label for="filtre-etat">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M450-420q38 0 64-26t26-64q0-38-26-64t-64-26q-38 0-64 26t-26 64q0 38 26 64t64 26Zm193 160L538-365q-20 13-42.5 19t-45.5 6q-71 0-120.5-49.5T280-510q0-71 49.5-120.5T450-680q71 0 120.5 49.5T620-510q0 23-6.5 45.5T594-422l106 106-57 56ZM200-120q-33 0-56.5-23.5T120-200v-160h80v160h160v80H200Zm400 0v-80h160v-160h80v160q0 33-23.5 56.5T760-120H600ZM120-600v-160q0-33 23.5-56.5T200-840h160v80H200v160h-80Zm640 0v-160H600v-80h160q33 0 56.5 23.5T840-760v160h-80Z"/></svg>
						État :
					</label>
					<select id="filtre-etat" name="etat">
						<option value="">Tous les états</option>
						<option value="perime" {% if request.args.get('etat') == 'perime' %}selected{% endif %}>Périmés</option>
						<option value="bientot" {% if request.args.get('etat') == 'bientot' %}selected{% endif %}>Expire bientôt</option>
						<option value="stock" {% if request.args.get('etat') == 'stock' %}selected{% endif %}>Stock bas</option>
						<option value="ok" {% if request.args.get('etat') == 'ok' %}selected{% endif %}>OK</option>
					</select>
				</div>

				<div class="filter-group">
					<a href="{{ url_for('inventaire.inventaire') }}" class="btn-action">Réinitialiser</a>
				</div>
			</div>

			<div class="table-header">
				<h2 class="page-title">
					<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M360-200v-80h480v80H360Zm0-240v-80h480v80H360Zm0-240v-80h480v80H360ZM200-160q-33 0-56.5-23.5T120-240q0-33 23.5-56.5T200-320q33 0 56.5 23.5T280-240q0 33-23.5 56.5T200-160Zm0-240q-33 0-56.5-23.5T120-480q0-33 23.5-56.5T200-560q33 0 56.5 23.5T280-480q0 33-23.5 56.5T200-400Zm0-240q-33 0-56.5-23.5T120-720q0-33 23.5-56.5T200-800q33 0 56.5 23.5T280-720q0 33-23.5 56.5T200-640Z"/></svg>
					<span>Liste Générale des Objets</span>
				</h2>
				<div class="page-actions-container">
					{% if session.user_id %}
					<button id="add-object-btn" class="btn-action" data-modal-trigger="add-object-modal">Ajouter un matériel</button>
					{% endif %}
				</div>
			</div>

			<div id="dynamic-content" data-endpoint="inventaire" data-sort-by="{{ sort_by }}" data-direction="{{ direction }}">
				{% include '_inventaire_content.html' %}
			</div>
		</div>

		{% include 'footer.html' %}
		{% include 'modale_objet.html' %}
        {% include '_modale_danger.html' %}
	</body>
</html>